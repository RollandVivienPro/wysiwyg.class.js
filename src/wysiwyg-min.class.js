"use strict";class Wysiwyg{constructor(e,t=[]){if("textarea"!==e.type)throw new TypeError("Object must be a textarea");if(!Array.isArray(t))throw new TypeError("elems must be an array");this.baseBtns=[{icon:'<i class="fas fa-undo"></i>',cmd:"undo"},{icon:'<i class="fas fa-redo"></i>',cmd:"redo"},{class:"v-wysiwyg-toggle-code",icon:'<i class="fas fa-glasses"></i>'}],this.baseBtns.splice(2,0,...t),this.textarea=e,this.container=document.createElement("div"),this.container.setAttribute("class","v-wysiwyg-container"),this.box=document.createElement("div"),this.box.setAttribute("class","v-wysiwyg-text"),this.box.setAttribute("contentEditable",!0),this.menu=document.createElement("div"),this.menu.setAttribute("class","v-wysiwyg-menu"),this.viewSource=!0,this.createWrapper()}createWrapper(){this.textarea.parentNode.insertBefore(this.container,this.textarea),this.container.appendChild(this.textarea),this.textarea.style.display="none",this.textarea.parentNode.insertBefore(this.box,this.textarea),this.box.parentNode.insertBefore(this.menu,this.box),this.box.innerHTML=this.textarea.value,this.allBtns=[],this.baseBtns.forEach(e=>{let t=document.createElement("button");null==e.class?t.setAttribute("class","v-wysiwyg-btn"):t.setAttribute("class",e.class),t.addEventListener("click",t=>{t.preventDefault(),void 0!==e.cmd&&(this._execCommand(e.cmd),this.box.focus(),this.textarea.value=this.box.innerHTML)}),t.innerHTML=e.icon,this.allBtns.push(t),this.menu.appendChild(t)}),this.createBtnListeners(),this.createBoxListeners()}createBtnListeners(){this.allBtns.forEach(e=>{e.classList.contains("v-wysiwyg-toggle-code")&&e.addEventListener("click",e=>{if(e.preventDefault(),!0===this.viewSource){this.viewSource=!1;let e=this.box.innerHTML;this.box.style.display="none",this.textarea.value=e,this.textarea.style.display="block"}else{this.viewSource=!0;let e=this.textarea.value;this.textarea.style.display="none",this.box.innerHTML=e,this.box.style.display="block"}})})}createBoxListeners(){document.execCommand("defaultParagraphSeparator",!1,"p"),this.box.addEventListener("keydown",()=>{let e=this.box.innerHTML.replace(/(<([^>]+)>)/gi,"");if(1==e.length){this.box.innerHTML="<p>"+e+"</p>";let t=document.createRange(),s=window.getSelection();t.setStart(this.box.querySelector("p"),1),t.collapse(!0),s.removeAllRanges(),s.addRange(t)}})}_execCommand(e){let t=!1;switch(e){case"formatBlock":t="blockquote";break;case"createLink":t=prompt("Entrez l'URL du lien :");break;case"insertImage":t=prompt("Entrez l'URL de l'image :")}return document.execCommand(e,!1,t),!0}}